sudo: required
dist: trusty
language: cpp

# Install Bazel and cppcheck.
install:
  - sudo apt-get update
  - sudo apt-get install pkg-config zip g++ zlib1g-dev unzip python
  - sudo add-apt-repository -y ppa:webupd8team/java
  - sudo apt-get update && sudo apt-get install oracle-java8-installer
  - sudo echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list
  - curl https://storage.googleapis.com/bazel-apt/doc/apt-key.pub.gpg | sudo apt-key add -
  - sudo apt-get update && sudo apt-get install bazel
  - sudo apt-get install cppcheck

matrix:
  include:
  # CppCheck
  - os: linux
    env:
      - TEST="CppCheck"
    script:
      - cppcheck --version
      - cppcheck --inline-suppr --enable=all --error-exitcode=1 -I m3/include/ -I tally/include/ -i m3/include/m3/thrift/ --suppress='*:m3/include/m3/thrift/*' m3/ tally/
  # Clang
  - os: linux
    env:
      - TEST="Clang"
    script:
      - export CXX="clang++"
      - export CC="clang"
      - clang --version
      - bazel version
      - bazel build //...
      - bazel test --test_output=all --test_timeout=60 //...
  # GCC
  - os: linux
    env:
      - TEST="GCC"
    script:
      - export CXX="g++"
      - export CC="gcc"
      - gcc --version
      - bazel version
      - bazel build //...
      - bazel test --test_output=all --test_timeout=60 //...
