sudo: required
dist: trusty
language: cpp

# Install Bazel and cppcheck.
install:
  - sudo apt-get update
  - sudo apt-get install pkg-config zip g++ zlib1g-dev unzip python
  - sudo add-apt-repository -y ppa:webupd8team/java
  - sudo apt-get update && sudo apt-get install oracle-java8-installer
  - sudo echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list
  - curl https://storage.googleapis.com/bazel-apt/doc/apt-key.pub.gpg | sudo apt-key add -
  - sudo apt-get update && sudo apt-get install bazel
  - sudo apt-get install cppcheck

compiler:
  - clang
  - gcc

script:
  - cppcheck --inline-suppr --enable=all -I m3/include/ -I tally/include/ -i m3/include/m3/thrift/ --suppress='*:m3/include/m3/thrift/*' m3/ tally/
  - bazel build //...
  - bazel test --test_output=all --test_timeout=60 //...
